name: 'SSCA Plugin'
description: 'A GitHub Action to run a Docker container as part of the SSCA plugin.'
author: 'Your Name'
inputs:
  HARNESS_EXECUTION_ID:
    description: 'Pipeline execution ID (Drone environment variable)'
    required: true
  HARNESS_ACCOUNT_ID:
    description: 'Pipeline account ID (Drone environment variable)'
    required: true
  HARNESS_STAGE_ID:
    description: 'Pipeline stage ID (Drone environment variable)'
    required: true
  HARNESS_BUILD_ID:
    description: 'Pipeline build ID (Drone environment variable)'
    required: true
  HARNESS_PIPELINE_ID:
    description: 'Pipeline pipeline ID (Drone environment variable)'
    required: true
  HARNESS_PROJECT_ID:
    description: 'Pipeline project ID (Drone environment variable)'
    required: true
  PLUGIN_TOOL:
    description: 'Tool which needs to be orchestrated (e.g., Syft, Blackduck)'
    required: true
  PLUGIN_FORMAT:
    description: 'Format of SBOM to be generated by plugin tool (e.g., SPDX, CYCLONEDX)'
    required: true
  PLUGIN_SBOMSOURCE:
    description: 'Image or repo source (e.g., /harness/repo)'
    required: true
  PLUGIN_SBOMDESTINATION:
    description: 'SBOM destination (optional, e.g., /harness/sbom)'
    required: false
  SSCA_SERVICE_Endpoint:
    description: 'URL of the SSCA service (e.g., localhost:8186)'
    required: true
  SSCA_SERVICE_TOKEN:
    description: 'Auth token for authentication with SSCA service'
    required: true
  PLUGIN_TYPE:
    description: 'Type of plugin (Orchestrate or Enforce, will be deprecated)'
    required: true
  ATTEST_SBOM:
    description: 'If attestation is required'
    required: true
    type: boolean
  COSIGN_PASSWORD:
    description: 'Private key for attestation'
    required: true

runs:
  using: 'docker'
  image: 'harness/ssca-plugin:latest'
  env:
    HARNESS_EXECUTION_ID: ${{ inputs.HARNESS_EXECUTION_ID }}
    HARNESS_ACCOUNT_ID: ${{ inputs.HARNESS_ACCOUNT_ID }}
    HARNESS_STAGE_ID: ${{ inputs.HARNESS_STAGE_ID }}
    HARNESS_BUILD_ID: ${{ inputs.HARNESS_BUILD_ID }}
    HARNESS_PIPELINE_ID: ${{ inputs.HARNESS_PIPELINE_ID }}
    HARNESS_PROJECT_ID: ${{ inputs.HARNESS_PROJECT_ID }}
    PLUGIN_TOOL: ${{ inputs.PLUGIN_TOOL }}
    PLUGIN_FORMAT: ${{ inputs.PLUGIN_FORMAT }}
    PLUGIN_SBOMSOURCE: ${{ inputs.PLUGIN_SBOMSOURCE }}
    PLUGIN_SBOMDESTINATION: ${{ inputs.PLUGIN_SBOMDESTINATION }}
    SSCA_SERVICE_Endpoint: ${{ inputs.SSCA_SERVICE_Endpoint }}
    SSCA_SERVICE_TOKEN: ${{ inputs.SSCA_SERVICE_TOKEN }}
    PLUGIN_TYPE: ${{ inputs.PLUGIN_TYPE }}
    ATTEST_SBOM: ${{ inputs.ATTEST_SBOM }}
    COSIGN_PASSWORD: ${{ inputs.COSIGN_PASSWORD }}
